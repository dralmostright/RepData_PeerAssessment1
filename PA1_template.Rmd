# Coursera D.S Reproducible Research: Peer Assessment 1

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading and preprocessing the data
Download the dataset and extract to workspace if not already in workspace.
```{r}
filename <- "/R/workspace/RepData_PeerAssessment1/activity.zip"

if (!file.exists(filename)){
  fileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
  download.file(fileURL, filename, method="curl")
}  

if (!file.exists("/R/workspace/RepData_PeerAssessment1/activity.csv")) { 
  unzip(filename, exdir='/R/workspace/RepData_PeerAssessment1') 
}

data <- read.csv('activity.csv')
```

## Mean total number of steps taken per day
Calcuate the total number of steps taken in day and generate histogram, also calulate mean and median

```{r}
aggregatedTotalSteps <- aggregate(steps ~ date, data, sum)
hist(aggregatedTotalSteps$steps, breaks=30, main="Total Steps taken per Day", xlab="Steps", ylab="Frequency")
```

Calculate and report the mean and median of the total number of steps taken per day
```{r}
# Calculate Mean
median(aggregatedTotalSteps$steps)

#Calculate Median
mean(aggregatedTotalSteps$steps)
```

## What is the average daily activity pattern?
1) Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r}
steps_by_interval <- aggregate(steps ~ interval, data, mean)

plot(steps_by_interval$interval,steps_by_interval$steps, type="l", xlab="Interval", ylab="Number of Steps",main="Average Number of Steps per Day by Interval")
```

2) Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

```{r}
steps_by_interval[steps_by_interval$steps==max(steps_by_interval$steps),1]

```


## Imputing missing values
Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)
```{r}
sum(is.na(data$steps))
```

Fill the missing values with the by taking mean for that 5-minute interval, and mean for 5-minute interval are ceiled and Create a new dataset that is equal to the original dataset but with the missing data filled in.
```{r}
#data$interval <- as.factor(data$interval)
tempIntervalmean <- aggregate(steps ~ interval, data, mean)
tempIntervalmean$steps <- ceiling(tempIntervalmean$steps)

head(tempIntervalmean,10)
for(i in 1:nrow(data)){
	if(is.na(data[i,1]))
		data[i,1] <- tempIntervalmean$steps[tempIntervalmean$interval == data[i,3]]
}

# Check for data
head(data)
```

Make a histogram of the total number of steps taken each day after Imputing missing values

```{r}
aggregatedTotalSteps <- aggregate(steps ~ date, data, sum)
hist(aggregatedTotalSteps$steps, breaks=30, main="Total Steps taken per Day\n After data cleaning", xlab="Steps", ylab="Frequency")

```

Calculate Mean and median for cleaned data

```{r}
# Calculate Median
median(aggregatedTotalSteps$steps)

#Calculate Mean
mean(aggregatedTotalSteps$steps)
```

## Are there differences in activity patterns between weekdays and weekends?

```{r}
library(ggplot2)
data$daytype <- 0

data$date <- as.Date(data$date)
for(i in 1:nrow(data)){
	if(weekdays(data[i,2]) %in% c('Sunday', 'Saturday'))
		data[i,4] <- "weekend"
	else
		data[i,4] <- "weekday"
}

head(data)

#data$daytype <- as.factor(data$daytype)
#data$interval <- as.numeric(data$interval)

head(data)
aggDataWeetype <- aggregate(steps ~ interval + daytype, data, mean)

#xyplot(steps ~ interval | factor(daytype), data=aggDataWeetype, aspect=1/3, type="l")

averages <- aggregate(steps ~ interval + daytype, data=data, mean)
ggplot(averages, aes(interval, steps)) + geom_line( aes(color = daytype, group=daytype)) + facet_grid(daytype ~ .) +
    xlab("5-minute interval") + ylab("Number of steps")


```
